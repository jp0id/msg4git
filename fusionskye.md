<!--
[153] [201728830] [2025-07-21 05:46] 
-->

## Apdex算法优化
#UX #PerformanceOptimization

用户体验度算法优化  
优化前算法：  
Satisfied（满意）：应用响应时间低于或等于Apdex阈值。比如Apdex阈值为1.5s，则一个耗时1s的响应结果则可以认为是满意的。  
Tolerating（可容忍）：应用响应时间大于Apdex阈值，但同时小于或等于4倍的Apdex阈值。假设应用设定的Apdex阈值为1s，则4*1=4s为应用响应时间的容忍上限。  
Frustrated（沮丧）：应用响应时间大于4倍的Apdex阈值。  
  
Apdex=（满意样本*1+可容忍样本*0.5+沮丧样本*0）/样本总数  
  
缺陷说明：  
以上指标只考虑了响应时间对用户体验的影响，没有考虑业务失败和请求无法正常发送的情况，即当出现大量业务失败甚至业务无法处理导致交易量骤降时，用户体验度仍然可能很高。  
  
优化方案：  
在“沮丧”样本中，考虑失败和未响应的交易，即不论响应时间长短，只要是失败或未响应的交易，直接计入沮丧数量。  
样本总数不仅以实际交易数量为准，而是以基线值和交易量实际值中更大的一个为准。  
Apdex阈值从固定写死，改为从过去一天的平均响应时间做中位数平滑，以实现对不同业务有更加契合的不同标准。  
  
案例对比：  
当交易全部失败，但响应时间都正常时：  
优化前，用户体验度为100，不符合预期。  
优化后，用户体验度为0，符合预期。  
  
交易量突降到之前的10%，响应时间和成功率都正常：  
优化前，用户体验度为100，不符合预期。  
优化后，用户体验度约为10，符合预期。  

---

