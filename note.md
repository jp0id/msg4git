<!--
[252] [201728830] [2025-07-24 08:22] 
-->

## Shell Scripting Tips
#Bash #Coding

在shell脚本中，我们经常需要根据命令执行的成功与否来决定后续操作。两种写法都可以达到目的，但第二种写法（`if ! command; then ... fi`）通常更受推荐，原因如下：  
  
1. **简洁性**：第二种写法将命令执行和状态检查合并到一行，减少了代码行数，使代码更紧凑。  
2. **可读性**：直接使用`if`语句检查命令的返回值更符合编程习惯，逻辑表达更清晰。  
3. **避免中间变量**：不需要使用`$?`来获取退出状态，减少了中间步骤。  
4. **防止状态被覆盖**：在第一种写法中，如果在`make`和检查`$?`之间插入其他命令，可能会改变`$?`的值，导致错误判断。第二种写法避免了这种风险。  
5. **原子性**：第二种写法将命令执行和检查作为一个原子操作，更不容易出错。  
  
具体分析：  
  
- 第一种写法：  
  ```bash  
  make mytarget  
  if [ $? -ne 0 ]  
  then  
    echo "Build failed"  
  fi  
  
```  
  这里先执行`make`，然后检查其退出状态。如果`make`失败（返回非0），则输出错误信息。  
  
- 第二种写法：  
  ```bash  
  if ! make mytarget  
  then  
    echo "Build failed"  
  fi  
  
```  
  这里直接检查`make`命令的退出状态。`!`操作符对命令的返回值进行逻辑取反：如果`make`返回0（成功），则`!`使其变为非0（条件不成立）；如果`make`返回非0（失败），则`!`使其变为0（条件成立），从而执行`then`分支。  
  
注意：第二种写法中的`!`会反转命令的返回值，因此当`make`失败（返回非0）时，整个条件为真，进入`then`分支。  
  
另外，也可以不使用`!`，而直接利用shell中`if`检查命令退出状态为0时条件为真的特性：  
  
```bash  
if make mytarget; then  
  : # 成功什么都不做  
else  
  echo "Build failed"  
fi  
```  
  
或者更简洁地：  
  
```bash  
make mytarget || echo "Build failed"  
```  
  
但注意，`||`操作符只能执行单条命令（或使用花括号组合多条命令），而`if`结构可以包含多条命令。  
  
因此，根据具体需求选择合适的方式。当需要在失败时执行多个操作时，使用`if ! ...`或`if ...; then ... else ... fi`结构会更清晰。  
  
总结：第二种写法（使用`if ! command`）更优，因为它更简洁、安全、可读。  

---


<!--
[235] [201728830] [2025-07-21 07:47] 
-->

## Logging Efficiency Boost
#BilingualLogs #DebuggingEase

目前 MGOne 各组件输出的纯英文日志现场高压环境下读取有一定难度，考虑所有需要现场同学排查分析问题的日志，同时输出中英文日志。  
中文方便现场排查提高效率，英文确保终端无法显示中文时依然保留足够的信息。  

---



